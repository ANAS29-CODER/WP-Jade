!function(){function e(e,t=null){console.log("ACF Card : "+e),t&&console.log(t)}if(!(window.hasOwnProperty("acf_cards")&&window.acf_cards.hasOwnProperty("ajaxData")&&window.acf_cards.ajaxData.hasOwnProperty("url")&&window.acf_cards.ajaxData.hasOwnProperty("name")))throw e("ajax data is missing"),new Error("ajax data is missing");const t={ACF_CARD:"acf-card",PAGINATION:"acf-card__pagination",PAGINATION__TYPE__BUTTON:"acf-card__pagination--type--load_more_button",PAGINATION__TYPE__PAGES:"acf-card__pagination--type--page_numbers",PAGINATION__TYPE__INFINITY:"acf-card__pagination--type--infinity_scroll",PAGINATION__LOCKED:"acf-card__pagination--locked",LOAD_MORE:"acf-card__load-more",ITEMS:"acf-card__items",PAGE:"acf-card__page",PAGE__ACTIVE:"acf-card__page--active"},a={BUTTON:"button",PAGES:"pages",INFINITY:"infinity"},i={PAGES_AMOUNT:"pagesAmount",CARD_ID:"cardId",PAGE_NUMBER:"pageNumber"},s=window.acf_cards.ajaxData.url,n=window.acf_cards.ajaxData.name;class r{constructor(e,s){this.element=e,this.pagination=s,this.pageNumber=1,this.pagesAmount=parseInt(s.dataset[i.PAGES_AMOUNT]||0),this.cardId=parseInt(s.dataset[i.CARD_ID]||0),this.isRunningAjax=!1,this.scrollListener=null,this.paginationType="",this.paginationType=s.classList.contains(t.PAGINATION__TYPE__BUTTON)?a.BUTTON:this.paginationType,this.paginationType=s.classList.contains(t.PAGINATION__TYPE__PAGES)?a.PAGES:this.paginationType,this.paginationType=s.classList.contains(t.PAGINATION__TYPE__INFINITY)?a.INFINITY:this.paginationType,this.setupListeners()}setupListeners(){switch(this.paginationType){case a.BUTTON:this.element.querySelector("."+t.LOAD_MORE).addEventListener("click",this.prepareAjax.bind(this));break;case a.PAGES:this.element.querySelectorAll("."+t.PAGE).forEach((e=>{e.addEventListener("click",this.prepareAjax.bind(this))}));break;case a.INFINITY:this.scrollListener=this.prepareAjax.bind(this),window.addEventListener("scroll",this.scrollListener)}}prepareAjax(s){if(!this.isRunningAjax){if(a.INFINITY===this.paginationType){if(this.element.getBoundingClientRect().bottom-2*window.innerHeight>0)return}switch(this.isRunningAjax=!0,this.pagination.classList.add(t.PAGINATION__LOCKED),this.paginationType){case a.BUTTON:this.pageNumber++;break;case a.PAGES:s.stopPropagation(),s.preventDefault();let n=s.target.closest("."+t.PAGE),r=parseInt(n.dataset[i.PAGE_NUMBER])||0;if(r<1||r>this.pagesAmount)return e("requested page number is over limits"),void this.removePaginationUI();this.element.querySelector("."+t.PAGE__ACTIVE).classList.remove(t.PAGE__ACTIVE),this.pageNumber=r;break;case a.INFINITY:this.pageNumber++}this.makeAjax()}}removePaginationUI(){switch(this.paginationType){case a.BUTTON:this.pagination.remove(),this.pagination=null;break;case a.INFINITY:window.removeEventListener("scroll",this.scrollListener),this.scrollListener=null}}updateUIAfterAjax(){if(this.pageNumber===this.pagesAmount&&a.PAGES!==this.paginationType)return this.removePaginationUI(),void(this.isRunningAjax=!1);a.PAGES===this.paginationType&&this.element.querySelector("."+t.PAGE+'[data-page-number="'+this.pageNumber+'"]').classList.add(t.PAGE__ACTIVE),this.isRunningAjax=!1,this.pagination.classList.remove(t.PAGINATION__LOCKED)}makeAjax(){let t=new FormData;t.append("action",n),t.append("_noCache",(new Date).getTime().toString()),t.append("_acfCardId",this.cardId),t.append("_pageNumber",this.pageNumber);const a=new XMLHttpRequest;a.timeout=3e4,a.open("POST",s,!0),a.addEventListener("readystatechange",this.processAjaxResponse.bind(this,a)),a.addEventListener("timeout",(()=>{e("ajax timeout"),this.removePaginationUI()})),a.send(t)}processAjaxResponse(i){if(4!==i.readyState)return;if(200!==i.status)return void e("ajax request is failed");let s={};try{if(s=JSON.parse(i.responseText),!s.hasOwnProperty("error")||!s.hasOwnProperty("html"))throw new Error("Property is missing")}catch(t){return e("ajax response is wrong"),void this.removePaginationUI()}if(s.error)return e("ajax request was wrong, details : "+s.error),void this.removePaginationUI();a.PAGES===this.paginationType?this.element.querySelector("."+t.ITEMS).innerHTML=s.html:this.element.querySelector("."+t.ITEMS).innerHTML+=s.html,this.updateUIAfterAjax()}}new class{constructor(){"loading"!==document.readyState?this.setup():window.addEventListener("DOMContentLoaded",this.setup.bind(this))}setup(){new MutationObserver(((e,t)=>{for(let t of e)t.addedNodes.forEach((e=>{this.addListeners(e)}))})).observe(document.body,{childList:!0,subtree:!0}),this.addListeners(document.body)}addListeners(e){Node.ELEMENT_NODE===e.nodeType&&e.querySelectorAll("."+t.PAGINATION).forEach((e=>{let a=e.closest("."+t.ACF_CARD);a&&new r(a,e)}))}}}();